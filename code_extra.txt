    
*QC program;
libname pha "/harvard/aking/DataQC/pha/data/";
libname acap "/archive/LSANALYT/";
%include '/home/aking/assign_libnames.sas';
options nocenter nofmterr mprint symbolgen mlogic mprint;

proc freq data=pha.training_sample_pid_pha;
	tables phq8_score phq2_score/missing;
run;
endsas;

ods excel file = "/harvard/aking/DataQC/pha/tables/variable_list.xlsx";
*/*;
proc contents data=pha.test_sample order=varnum; run;
ods excel close;
endsas;
proc import out=predprob_sample3_train
			datafile = "/harvard/aking/DataQC/pha/data/predprob_sample3_train.csv"
			dbms=csv replace;
		getnames= yes;
		datarow=2;
run;
proc import out=predprob_sample3_test
			datafile = "/harvard/aking/DataQC/pha/data/predprob_sample3_test.csv"
			dbms=csv replace;
		getnames= yes;
		datarow=2;
run;
ods excel file = "/harvard/aking/DataQC/pha/tables/pha_ctab_MC.xlsx";
*/*;
proc surveyfreq data=pha.training_sample missing;
	weight weight2;
	tables outcome_6msa;
proc surveyfreq data=pha.training_sample missing;
	weight weight1;
	tables outcome_6msa;
	run;
proc freq data=pha.training_sample;
	tables (inout_29_anydx_03M
inp_9_anydx_12M
inp_5_anydx_06M
inp_5_anydx_03M
pm_suicide_attempt_medical
pm_suicide_attempt_medical_num
v_homicidal_ideation_1m
n_v_homicidal_ideation_1m)*outcome_6msa
/missing;
run;
*/*;
proc freq data=pha.test_sample;
	tables (inout_29_anydx_03M
inp_9_anydx_12M
inp_5_anydx_06M
inp_5_anydx_03M
pm_suicide_attempt_medical
pm_suicide_attempt_medical_num
v_homicidal_ideation_1m
n_v_homicidal_ideation_1m)*outcome_6msa
/missing list ;
run;
ods excel close; 
endsas;

data work1;
	set harvrd04.PHA_V25_V3; 
	
	if phq9_score_nmiss eq 0 or phq2_score_nmiss eq 0 then do;
		flag_phq_nonmiss=1;
		if phq9_q9 eq . then phq9_q9=0;
		*if phq9_score eq . then phq9_score=phq2_score;
	end;
	
run;

proc sql;
	create table work2 as 
		select distinct pid_pde, year, 
			sum(flag_phq_nonmiss) as pycount_phq_surveys label = "Count of number of phq 2/9 surveys per year"		
		from work1
		group by pid_pde, year
		order by pid_pde, year;
quit;

ods excel file = "/harvard/aking/DataQC/tables/pha_ctab_MC.xlsx";
proc freq data=pha.training_sample_pid_pha_int;
	tables outcome_6msa/missing;
run;
proc freq data=pha.test_sample_pid_pha_int;
	tables outcome_6msa/missing;
run;
ods excel close; 
endsas;
proc means data=work1 n min p25 median p75 max nmiss;
	var phq9_score phq2_score;
	class year;
proc freq data=work1;
	tables year*phq9_q9;
run;
proc freq data=harvrd04.PHA_V25_V3; 
		tables 
			(phq9_q: 
			phq9_score
			phq9_items_nmiss phq9_score_nmiss
			phq2_score
			phq2_score_nmiss
			phq10_score)*regular_army/missing;
run;
ods excel close; 
endsas;

/*; 
tables year_month_key*regular_army;
		format year_month_key year4. ;
		where phq9_score_nmiss eq 0 or phq2_score_nmiss eq 0;
		
ods excel file = "/harvard/aking/DataQC/tables/pha_ctab_v25.xlsx";
proc freq data=lsq2.TA_pha_newform_v25;
	tables  BH_LITTLEINTEREST*BH_LITTLEINTEREST_2*BH_WEEKS_LITTLE_INTEREST  
			BH_FEELINGBAD*BH_FEELINGBAD_2*BH_WEEKS_DEPRESSED
				BH_POORSLEEP*BH_WEEKS_SLEEP
				BH_TIRED*BH_WEEKS_TIRED
				BH_POORAPPETITE*BH_WEEKS_APPETITE
				bH_FEELAFAILURE*BH_WEEKS_FAILURE
				BH_TROUBLECONCENTRATING*BH_WEEKS_CONCENTRATE
				BH_SLOWORRESTLESS*BH_WEEKS_LETHARGIC_JUMPY
				BH_HURTINGSELF*BH_MHTHOUGHTS /missing list;
run;
ods excel close;
endsas;


ods excel file = "/harvard/aking/DataQC/tables/pha_ctab_v3.xlsx";
proc freq data=lsq2.TA_pha_newform_v3_data;
	tables 
BH_LITTLE_INTEREST*BH_LITTLE_INTEREST_2*BH_WEEKS_LITTLE_INTEREST 
BH_FEELING_BAD*BH_FEELING_BAD_2*BH_WEEKS_DEPRESSED
BH_POORSLEEP*BH_WEEKS_SLEEP
BH_TIRED*BH_WEEKS_TIRED
BH_POOR_APPETITE*BH_WEEKS_APPETITE
BH_FEEL_A_FAILURE*BH_WEEKS_FAILURE
BH_TROUBLE_CONCENTRATING*BH_WEEKS_CONCENTRATE
BH_SLOW_OR_RESTLESS*BH_WEEKS_LETHARGIC_JUMPY
BH_HURTING_SELF*bh_mh_thoughts
			
			
			 
			
			 
			 
			
			/missing list;
run;
ods excel close;
endsas;

ods excel file = "/harvard/aking/DataQC/tables/pha_ctab_v3.xlsx";
proc freq data=lsq2.TA_pha_newform_v3_data;
	tables 
phapulhes_suicide_a phapulhes_suicide_b
BH_HURTING_SELF*bh_mh_thoughts*phapulhes_suicide_b
			
			
			 
			
			 
			 
			
			/missing list;
run;
ods excel close;
endsas;


ods excel file = "/harvard/aking/DataQC/tables/pha_ctab_v25.xlsx";
proc freq data=lsq2.TA_pha_newform_v25;
	tables  pulhes_suicide_a pulhes_suicide_b
				BH_HURTINGSELF*BH_MHTHOUGHTS*pulhes_suicide_b /missing list;
run;
ods excel close;
endsas;








